% Plot comparison between XFEM and mixed scheme for diffusion tensor
% Tested on circles with varying radius

compareXFEM = [1, 0, 0, 1; 0.999718741652008, -1.29949064201435e-05, -1.29949064201436e-05, 0.999718741652012; 0.998022065721505, -4.41111512474084e-05, -4.41111512474078e-05, 0.998022065721508; 0.994929943807854, -7.83400986180837e-05, -7.83400986180842e-05, 0.994929943807853; 0.990571286807450, -7.01476634669957e-05, -7.01476634669958e-05, 0.990571286807447; 0.984999864981254, -6.05037436368495e-05, -6.05037436368493e-05, 0.984999864981251; 0.978219720562166, -7.16562635044073e-05, -7.16562635044052e-05, 0.978219720562171; 0.970273773464986, -7.37038535626293e-05, -7.37038535626272e-05, 0.970273773464987; 0.961175758844015, -6.71989349930009e-05, -6.71989349930228e-05, 0.961175758844013; 0.950959987468735, -7.50419298410923e-05, -7.50419298416208e-05, 0.950959987468731; 0.939669071075471, -7.04158843881295e-05, -7.04158843880750e-05, 0.939669071075474; 0.927331489812738, -5.93960901198508e-05, -5.93960901198461e-05, 0.927331489812736; 0.913998510082113, -5.87200297529883e-05, -5.87200297530015e-05, 0.913998510082107; 0.899721189151524, -5.41442653945038e-05, -5.41442653945025e-05, 0.899721189151531; 0.884537548825312, -5.24123091666051e-05, -5.24123091666137e-05, 0.884537548825310; 0.868498142694524, -5.42010736831059e-05, -5.42010736830964e-05, 0.868498142694523; 0.851654939635726, -5.35296365095087e-05, -5.35296365095553e-05, 0.851654939635723; 0.834050965144597, -5.43507492715445e-05, -5.43507492708932e-05, 0.834050965144600; 0.815743712632545, -5.61817729636650e-05, -5.61817729630082e-05, 0.815743712632544; 0.796782172970277, -5.48535550592443e-05, -5.48535550594093e-05, 0.796782172970272; 0.777213640267018, -5.51589920822768e-05, -5.51589920822439e-05, 0.777213640267017; 0.757092338595882, -5.17730199015785e-05, -5.17730199154911e-05, 0.757092338595879; 0.736466534683496, -4.53094867849007e-05, -4.53094867848922e-05, 0.736466534683497; 0.715387878232627, -4.32100619607865e-05, -4.32100619607964e-05, 0.715387878232630; 0.693906153591542, -4.02842907873400e-05, -4.02842907873389e-05, 0.693906153591540; 0.672064311635070, -3.83640385308008e-05, -3.83640385308125e-05, 0.672064311635075; 0.649905455385054, -3.82941384736371e-05, -3.82941384736290e-05, 0.649905455385052; 0.627471648887950, -3.71750455795215e-05, -3.71750455795641e-05, 0.627471648887952; 0.604798517355850, -3.66380283259710e-05, -3.66380283260854e-05, 0.604798517355851; 0.581922087478636, -3.63525862407583e-05, -3.63525862435299e-05, 0.581922087478637; 0.558873160514918, -3.48283637006314e-05, -3.48283636977031e-05, 0.558873160514917; 0.535677127511336, -3.30649598335149e-05, -3.30649598594946e-05, 0.535677127511336; 0.512357924402566, -2.96392302679652e-05, -2.96392302679754e-05, 0.512357924402565; 0.488934989316818, -2.58172867678688e-05, -2.58172867678743e-05, 0.488934989316819; 0.465421611709963, -2.35843203413660e-05, -2.35843203413684e-05, 0.465421611709962; 0.441826604019634, -2.15769830797480e-05, -2.15769830797422e-05, 0.441826604019633; 0.418149647904429, -1.96922151248975e-05, -1.96922151248719e-05, 0.418149647904429; 0.394385212458710, -1.85758154378479e-05, -1.85758154378486e-05, 0.394385212458711; 0.370520232330001, -1.71473080501756e-05, -1.71473080501446e-05, 0.370520232330000; 0.346530542450004, -1.57939066220179e-05, -1.57939066219911e-05, 0.346530542450005; 0.322383046885045, -1.43830931675261e-05, -1.43830931675141e-05, 0.322383046885042; 0.298029623475154, -1.26422309707183e-05, -1.26422309707244e-05, 0.298029623475156; 0.273403101712133, -1.05991151670901e-05, -1.05991151671424e-05, 0.273403101712133; 0.248412695199087, -8.20028465160424e-06, -8.20028465161039e-06, 0.248412695199087; 0.222928118112276, -6.23898202865137e-06, -6.23898202869020e-06, 0.222928118112275; 0.196755644882619, -4.65496166100464e-06, -4.65496166100415e-06, 0.196755644882619; 0.169592691571129, -3.32588375612822e-06, -3.32588375612799e-06, 0.169592691571129; 0.140913466417682, -2.18562929623070e-06, -2.18562929624230e-06, 0.140913466417682; 0.109667800321481, -1.24200831636668e-06, -1.24200831633607e-06, 0.109667800321481; 0.0730795393725474, -4.83380759796542e-07, -4.83380759796514e-07, 0.0730795393725470];
compareNEW = [1, 0, 0, 1; 0.999349775855017, -8.71185182655072e-05, -8.71185182655071e-05, 0.999349775855017; 0.997505533214679, -4.96839465883969e-05, -4.96839465883963e-05, 0.997505533214679; 0.994352854678705, -6.26161825187830e-05, -6.26161825187840e-05, 0.994352854678705; 0.989976991914207, -5.17943850727628e-05, -5.17943850727618e-05, 0.989976991914207; 0.984414118464144, -5.86593827587814e-05, -5.86593827587815e-05, 0.984414118464144; 0.977583888301534, -6.29997218023026e-05, -6.29997218023025e-05, 0.977583888301534; 0.969649499155257, -6.74309638766173e-05, -6.74309638766152e-05, 0.969649499155257; 0.960542160946219, -6.60066255204364e-05, -6.60066255204350e-05, 0.960542160946219; 0.950308469324555, -6.80401386720285e-05, -6.80401386720240e-05, 0.950308469324555; 0.939001095632814, -6.12723171303557e-05, -6.12723171303527e-05, 0.939001095632814; 0.926568574382742, -4.23969860921161e-05, -4.23969860921115e-05, 0.926568574382742; 0.913359625577114, -5.40584604139405e-05, -5.40584604139461e-05, 0.913359625577114; 0.899084763116734, -5.06515971940463e-05, -5.06515971940482e-05, 0.899084763116734; 0.883881137629174, -5.93693341525491e-05, -5.93693341525603e-05, 0.883881137629174; 0.867878951089290, -5.01347844893147e-05, -5.01347844893101e-05, 0.867878951089290; 0.851032895436929, -0.000109977163303553, -0.000109977163303555, 0.851032895436929; 0.833444851876726, -5.20746160525869e-05, -5.20746160525816e-05, 0.833444851876726; 0.815149601491468, -5.25015606511676e-05, -5.25015606511737e-05, 0.815149601491468; 0.796121233352035, -0.000102820595874065, -0.000102820595874066, 0.796121233352035; 0.776625179259798, -5.31747728979384e-05, -5.31747728979223e-05, 0.776625179259798; 0.756552031198619, -4.90054306818734e-05, -4.90054306818816e-05, 0.756552031198619; 0.735963282201958, -8.11922497391910e-05, -8.11922497391925e-05, 0.735963282201958; 0.714806580448335, -7.79794398404810e-05, -7.79794398404755e-05, 0.714806580448335; 0.693380587296170, -3.92550968503712e-05, -3.92550968503892e-05, 0.693380587296170; 0.671455564106626, -3.79309376609930e-05, -3.79309376609927e-05, 0.671455564106626; 0.649396627585847, -3.56905438079981e-05, -3.56905438080069e-05, 0.649396627585847; 0.627002446707408, -3.71419173529186e-05, -3.71419173529294e-05, 0.627002446707408; 0.604327866586287, -3.22220376773093e-05, -3.22220376773142e-05, 0.604327866586287; 0.581424236317783, -6.67727812475093e-05, -6.67727812475303e-05, 0.581424236317783; 0.558284868719002, -3.76572007813609e-05, -3.76572007813625e-05, 0.558284868719002; 0.535221011944896, -3.29319135548040e-05, -3.29319135547909e-05, 0.535221011944896; 0.511901421317046, -5.68785914001561e-05, -5.68785914001491e-05, 0.511901421317046; 0.488579038496387, -2.39545477334999e-05, -2.39545477335126e-05, 0.488579038496387; 0.465014410413669, -2.46477259582258e-05, -2.46477259582293e-05, 0.465014410413669; 0.441481156062468, -1.96597986560782e-05, -1.96597986560866e-05, 0.441481156062468; 0.417682842943622, -2.11162528654348e-05, -2.11162528654272e-05, 0.417682842943622; 0.393979127639639, -2.18528582875000e-05, -2.18528582875013e-05, 0.393979127639639; 0.370091143108565, -1.93891066885747e-05, -1.93891066885688e-05, 0.370091143108566; 0.346032952754807, -3.36359979910172e-05, -3.36359979910083e-05, 0.346032952754807; 0.321978706711314, -1.68329894861957e-05, -1.68329894861942e-05, 0.321978706711314; 0.297654032200798, -1.39791989863956e-05, -1.39791989864093e-05, 0.297654032200798; 0.272898848233135, -1.97011842780001e-05, -1.97011842779943e-05, 0.272898848233135; 0.248061633082845, -2.95159437616838e-05, -2.95159437616856e-05, 0.248061633082844; 0.222563800407023, -6.88348733431142e-06, -6.88348733431370e-06, 0.222563800407023; 0.196413473882368, -1.36942989658409e-05, -1.36942989658356e-05, 0.196413473882368; 0.169290848618648, -4.95827961063664e-06, -4.95827961064070e-06, 0.169290848618648; 0.140578754000421, -3.68826092276558e-06, -3.68826092275910e-06, 0.140578754000421; 0.109300492096807, -2.22150067305123e-06, -2.22150067304315e-06, 0.109300492096807; 0.0778507321517622, -2.65379380498296e-06, -2.65379380498587e-06, 0.0778507321517623];

correct = [1.00000000000105, 0, 0, 1.00000000000105; 0.999460952350562, -1.31976929901637e-05, -1.31976929901513e-05, 0.999460952350563; 0.997579248142298, -8.88064261451057e-06, -8.88064261452287e-06, 0.997579248142306; 0.994452774812467, -1.00988843064696e-05, -1.00988843064690e-05, 0.994452774812461; 0.990090716797960, -1.12298539257424e-05, -1.12298539257435e-05, 0.990090716797957; 0.984506637483697, -8.96290417789840e-06, -8.96290417789674e-06, 0.984506637483701; 0.977725865107527, -9.76855810414295e-06, -9.76855810408157e-06, 0.977725865107501; 0.969772133244003, -1.05045261961069e-05, -1.05045261961041e-05, 0.969772133243995; 0.960671385298434, -8.85992618833355e-06, -8.85992618834029e-06, 0.960671385298418; 0.950459668868334, -9.28462148320741e-06, -9.28462148289755e-06, 0.950459668868308; 0.939172692479516, -1.00461254153398e-05, -1.00461254157071e-05, 0.939172692479494; 0.926846267380234, -8.68470292930239e-06, -8.68470292925265e-06, 0.926846267380216; 0.913525457832853, -8.76424745985075e-06, -8.76424745982575e-06, 0.913525457832814; 0.899254797715151, -9.50641363199991e-06, -9.50641363257273e-06, 0.899254797715108; 0.884077379617726, -8.41708616968047e-06, -8.41708616984458e-06, 0.884077379617673; 0.868044190329903, -8.20196641651429e-06, -8.20196641652827e-06, 0.868044190329846; 0.851205224906955, -8.90941774059746e-06, -8.90941774058632e-06, 0.851205224906897; 0.833607778622312, -8.00320307701048e-06, -8.00320307700006e-06, 0.833607778622243; 0.815305445184821, -7.59657055273003e-06, -7.59657055272830e-06, 0.815305445184736; 0.796350234361936, -8.20178205830950e-06, -8.20178205796208e-06, 0.796350234361861; 0.776790595853439, -7.48900562988957e-06, -7.48900562989339e-06, 0.776790595853334; 0.756679233647434, -6.95703066696286e-06, -6.95703066693790e-06, 0.756679233647331; 0.736066910458009, -7.41173822849975e-06, -7.41173822229453e-06, 0.736066910457892; 0.715000145090940, -6.87276275315096e-06, -6.87276275984483e-06, 0.715000145090826; 0.693527529988162, -6.27701318192395e-06, -6.27701320402036e-06, 0.693527529988042; 0.671695317292502, -6.50711615230729e-06, -6.50711615218269e-06, 0.671695317292377; 0.649545267436257, -6.17566728376939e-06, -6.17566728380523e-06, 0.649545267436135; 0.627118627371058, -5.55329030243580e-06, -5.55329030226174e-06, 0.627118627370940; 0.604454158125174, -5.59447342135412e-06, -5.59447342060561e-06, 0.604454158125044; 0.581585704387928, -5.40921159199430e-06, -5.40921158907992e-06, 0.581585704387817; 0.558544295774055, -4.80162145364818e-06, -4.80162144485209e-06, 0.558544295773951; 0.535358062129489, -4.70026276971177e-06, -4.70026276992619e-06, 0.535358062129416; 0.512049554382598, -4.59842021752144e-06, -4.59842023200647e-06, 0.512049554382555; 0.488636545259697, -4.02539441144383e-06, -4.02539441147732e-06, 0.488636545259745; 0.465132994623261, -3.82515790500074e-06, -3.82515790527416e-06, 0.465132994623354; 0.441546233755721, -3.75327339078131e-06, -3.75327339052078e-06, 0.441546233755842; 0.417876844438516, -3.23587049372194e-06, -3.23587049303916e-06, 0.417876844438661; 0.394119808728015, -2.96933663188882e-06, -2.96933663176606e-06, 0.394119808728165; 0.370261462835965, -2.89367121781587e-06, -2.89367121868735e-06, 0.370261462836122; 0.346278242452892, -2.44308728232703e-06, -2.44308728079060e-06, 0.346278242453052; 0.322136753546842, -2.14372519249350e-06, -2.14372519254492e-06, 0.322136753546996; 0.297789151894935, -2.04241057593405e-06, -2.04241057588948e-06, 0.297789151895072; 0.273168561878985, -1.66382372227609e-06, -1.66382372241552e-06, 0.273168561879085; 0.248183307587049, -1.36623980081921e-06, -1.36623979824373e-06, 0.248183307587056; 0.222702588890435, -1.23175749819051e-06, -1.23175749819947e-06, 0.222702588890439; 0.196532394779783, -9.29758894814351e-07, -9.29758894793962e-07, 0.196532394779788; 0.169368285175898, -6.70005716134301e-07, -6.70005716080820e-07, 0.169368285175903; 0.140684006663964, -5.12579597188789e-07, -5.12579619137050e-07, 0.140684006663969; 0.109425425072953, -2.99620565664309e-07, -2.99620565385265e-07, 0.109425425072958; 0.0727946826842953, -1.22452369719121e-07, -1.22452369686540e-07, 0.0727946826843021];
%correct = [1,0,0,1; 0.999399352818279,-3.38148570315526e-06,-3.38148570315397e-06,0.999399352818281;0.997517598699154,-2.83026039292893e-06,-2.83026039285763e-06,0.997517598699157;0.994388905784577,-2.65835812928544e-06,-2.65835812930108e-06,0.994388905784586;0.990025485271407,-3.00851682293454e-06,-3.00851682359404e-06,0.990025485271453;0.984442812958085,-3.08881327282628e-06,-3.08881327277723e-06,0.984442812958125;0.977661454595068,-2.80071898317211e-06,-2.80071898316921e-06,0.977661454595133;0.969706830238903,-2.67596496051322e-06,-2.67596496026156e-06,0.969706830238962;0.960607884576453,-2.85354993690392e-06,-2.85354993615191e-06,0.960607884576586;0.950396705607684,-2.93888596189718e-06,-2.93888596190840e-06,0.950396705607841;0.939108991639787,-2.71029998225563e-06,-2.71029998214396e-06,0.939108991640017;0.926784238989285,-2.57814380839733e-06,-2.57814381047158e-06,0.926784238989505;0.913464424628692,-2.66813944924795e-06,-2.66813944926159e-06,0.913464424629008;0.899193613198124,-2.75930917354100e-06,-2.75930917354344e-06,0.899193613198525;0.884017893537217,-2.56096478818528e-06,-2.56096478809075e-06,0.884017893537690;0.867985750830695,-2.41785389692307e-06,-2.41785389787189e-06,0.867985750831242;0.851146787610521,-2.44865902006933e-06,-2.44865902004758e-06,0.851146787611187;0.833551359909794,-2.53551889763140e-06,-2.53551889756809e-06,0.833551359910536;0.815250240286012,-2.35833202142779e-06,-2.35833202433793e-06,0.815250240286841;0.796295092698198,-2.21111956974453e-06,-2.21111949999094e-06,0.796295092699097;0.776737273417885,-2.19689260548833e-06,-2.19689260568864e-06,0.776737273418839;0.756627525107523,-2.26814416923255e-06,-2.26814416791981e-06,0.756627525108562;0.736015502276346,-2.11035631683477e-06,-2.11035632718733e-06,0.736015502277434;0.714950265394388,-1.96427763290941e-06,-1.96427763337199e-06,0.714950265395494;0.693479212031799,-1.91775179080067e-06,-1.91775178298554e-06,0.693479212032938;0.671647803844335,-1.96523772313638e-06,-1.96523771198636e-06,0.671647803845449;0.649499038995456,-1.82670628990766e-06,-1.82670629005582e-06,0.649499038996555;0.627073874809849,-1.68500046043483e-06,-1.68500046057307e-06,0.627073874810869;0.604410306158392,-1.61597863411752e-06,-1.61597863397992e-06,0.604410306159324;0.581543073002999,-1.63657086779460e-06,-1.63657086904708e-06,0.581543073003805;0.558503115607706,-1.51733098321592e-06,-1.51733097089841e-06,0.558503115608315;0.535317830098890,-1.38229099423858e-06,-1.38229099386207e-06,0.535317830099295;0.512010267028523,-1.29919554998837e-06,-1.29919560372434e-06,0.512010267028601;0.488598733895871,-1.29154186124406e-06,-1.29154186762560e-06,0.488598733895542;0.465096195419746,-1.19105582229617e-06,-1.19105582252331e-06,0.465096195419262;0.441510209370773,-1.06581091156528e-06,-1.06581088915099e-06,0.441510209370200;0.417842078259171,-9.76086729830616e-07,-9.76086726694682e-07,0.417842078258549;0.394086079505856,-9.40336311101729e-07,-9.40336314038177e-07,0.394086079505194;0.370228437479145,-8.58294432487617e-07,-8.58294432609190e-07,0.370228437478473;0.346246269182813,-7.45542332414406e-07,-7.45542332613380e-07,0.346246269182150;0.322105633579481,-6.56269339930931e-07,-6.56269339898995e-07,0.322105633578854;0.297758621517035,-6.02643002820232e-07,-6.02643002583606e-07,0.297758621516500;0.273138855295379,-5.31442335773554e-07,-5.31442334879723e-07,0.273138855295030;0.248154181106805,-4.34833986611532e-07,-4.34833986627804e-07,0.248154181106977;0.222673733598660,-3.53547977663625e-07,-3.53547977337645e-07,0.222673733598937;0.196503848684791,-2.93268796313917e-07,-2.93268796518895e-07,0.196503848685107;0.169339650019576,-2.30693986597926e-07,-2.30693986767192e-07,0.169339650019888;0.140654599604503,-1.56549396199425e-07,-1.56549396163511e-07,0.140654599604715;0.109394135678065,-9.40640627628176e-08,-9.40640652436078e-08,0.109394135677971;0.0727575429555162,-4.35253875685631e-08,-4.35253806939879e-08,0.0727575429554052;0.00115942909346163,-1.20742947199707e-11,-1.20742791271254e-11,0.00115942909346160];

figure
for i = 1:50
    XFEM(i) = norm(compareXFEM(i, :)-correct(i, :)) / norm(correct(i, :));
    NEW(i) = norm(compareNEW(i, :)-correct(i, :)) / norm(correct(i, :));
end
plot(0.01:0.01:0.48, XFEM(2:end - 1))
hold on
plot(0.01:0.01:0.48, NEW(2:end - 1))

title('Comparison XFEM - mixed formulation');
xlabel('radius')
ylabel('relative error')
legend('XFEM', 'MIXED');
set(gca, 'Yscale', 'log');

% comparison on 64x64
% reference on 164x164, 300x300